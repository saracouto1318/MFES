\begin{vdmpp}[breaklines=true]
class SafetyNetHospital
instance variables
 private hospitals: set of (Hospital);
 
 inv card hospitals >= 0;
operations

(*@
\label{SafetyNetHospital:8}
@*)
 public SafetyNetHospital : () ==> SafetyNetHospital
  SafetyNetHospital() == (hospitals := {}; return self)
 post hospitals = {};
  
(*@
\label{addHospital:12}
@*)
 public addHospital : Hospital ==> ()
  addHospital(h) == (hospitals := hospitals union {(*@\vdmnotcovered{h}@*)})
 pre h not in set (*@\vdmnotcovered{hospitals}@*)
 post h (*@\vdmnotcovered{in}@*) set (*@\vdmnotcovered{hospitals}@*);
 
(*@
\label{removeHospital:17}
@*)
 public removeHospital : Hospital ==> ()
  removeHospital(h) == (*@\vdmnotcovered{(}@*)(*@\vdmnotcovered{hospitals}@*) := hospitals \ {(*@\vdmnotcovered{h}@*)})
 pre h (*@\vdmnotcovered{in}@*) set (*@\vdmnotcovered{hospitals}@*)
 post h not in set (*@\vdmnotcovered{hospitals}@*);
 
(*@
\label{getHospitals:22}
@*)
 pure public getHospitals : () ==> set of (Hospital)
  getHospitals() == (return (*@\vdmnotcovered{hospitals}@*));
 
 -- Mudar -- 
(*@
\label{getHospitalsMoreAppointments:26}
@*)
 pure public getHospitalsMoreAppointments : Types`TaskType ==> Hospital
  getHospitalsMoreAppointments(t) == (*@\vdmnotcovered{(}@*)
                    dcl max: nat, hosp: Hospital;
                    max := (*@\vdmnotcovered{0}@*);
                    for all h in set (*@\vdmnotcovered{hospitals}@*) do
                     if((*@\vdmnotcovered{card}@*) ((*@\vdmnotcovered{h}@*).(*@\vdmnotcovered{getTasksByType}@*)((*@\vdmnotcovered{t}@*))) > (*@\vdmnotcovered{max}@*))
                      then (max := card (h.getTasksByType((*@\vdmnotcovered{t}@*))); (*@\vdmnotcovered{hosp}@*) := (*@\vdmnotcovered{h}@*));
                    (*@\vdmnotcovered{return}@*) (*@\vdmnotcovered{hosp}@*));
 
(*@
\label{getMedMoreHospitals:35}
@*)
 pure public getMedMoreHospitals : Types`Type ==> set of(HealthProfessional)
  getMedMoreHospitals(t) == (*@\vdmnotcovered{(}@*)
                  dcl doctors: set of(HealthProfessional);
                  for all h in set (*@\vdmnotcovered{hospitals}@*) do (*@\vdmnotcovered{(}@*)
                   dcl med: set of (HealthProfessional), list: set of(Hospital);
                   med := (*@\vdmnotcovered{h}@*).(*@\vdmnotcovered{getMedicalAssociatedByType}@*)((*@\vdmnotcovered{t}@*));
                   
                   (*@\vdmnotcovered{list}@*) := (*@\vdmnotcovered{hospitals}@*) \ {(*@\vdmnotcovered{h}@*)};
                   (*@\vdmnotcovered{for}@*) all m in set (*@\vdmnotcovered{med}@*) do(*@\vdmnotcovered{(}@*)
                    for all l in set (*@\vdmnotcovered{list}@*) do
                     if(m.getType() = t and m in set l.getMedicalAssociatedByType(t) (*@\vdmnotcovered{and}@*) m (*@\vdmnotcovered{not}@*) in set (*@\vdmnotcovered{doctors}@*))
                      then doctors := doctors union {(*@\vdmnotcovered{m}@*)};
                   );
                  );
                  
                  return (*@\vdmnotcovered{doctors}@*);
                 );
                               
(*@
\label{getMedAssociatedByPatient:53}
@*)
 pure public getMedAssociatedByPatient: Patient * Types`Type ==> map Hospital to set of(HealthProfessional)
  getMedAssociatedByPatient(p, t) == (*@\vdmnotcovered{(}@*)
                     dcl maps: map Hospital to set of(HealthProfessional), med : set of (HealthProfessional);
                     for all h in set hospitals do (*@\vdmnotcovered{(}@*)
                      for all m in set h.getMedicalAssociatedByType((*@\vdmnotcovered{t}@*)) do
                       if(p in set (*@\vdmnotcovered{m}@*).(*@\vdmnotcovered{getPatients}@*)())
                        then (*@\vdmnotcovered{med}@*) := (*@\vdmnotcovered{med}@*) (*@\vdmnotcovered{union}@*) {(*@\vdmnotcovered{m}@*)};
                       
                      maps := maps munion {h (*@\vdmnotcovered{|->}@*) (*@\vdmnotcovered{med}@*)};
                      (*@\vdmnotcovered{med}@*) := (*@\vdmnotcovered{\{}@*)};);
                      return (*@\vdmnotcovered{maps}@*));
 
(*@
\label{getMedByHospital:65}
@*)
 pure public getMedByHospital: Types`Type ==> map Hospital to set of(HealthProfessional)
  getMedByHospital(t) == (*@\vdmnotcovered{(}@*)
                     dcl maps: map Hospital to set of(HealthProfessional);
                     for all h in set (*@\vdmnotcovered{hospitals}@*) do
                      maps := maps munion {h |-> (*@\vdmnotcovered{h}@*).(*@\vdmnotcovered{getMedicalAssociatedByType}@*)((*@\vdmnotcovered{t}@*))};
                     return (*@\vdmnotcovered{maps}@*));
                     
(*@
\label{getTasksByHospital:72}
@*)
 pure public getTasksByHospital: Types`TaskType ==> map Hospital to set of(Task)
  getTasksByHospital(t) == (*@\vdmnotcovered{(}@*)
                     dcl maps: map Hospital to set of(Task);
                     for all h in set (*@\vdmnotcovered{hospitals}@*) do
                      (*@\vdmnotcovered{maps}@*) := maps munion {h (*@\vdmnotcovered{|->}@*) h.getTasksByType((*@\vdmnotcovered{t}@*))};
                     return (*@\vdmnotcovered{maps}@*));
                     
(*@
\label{getTrainingsByHospital:79}
@*)
 pure public getTrainingsByHospital: Types`Purpose ==> map Hospital to set of(Training)
  getTrainingsByHospital(t) == (*@\vdmnotcovered{(}@*)
                     dcl maps: map Hospital to set of(Training);
                     (*@\vdmnotcovered{for}@*) all h in set (*@\vdmnotcovered{hospitals}@*) do
                      maps := maps munion {h |-> h.getTrainingsByType((*@\vdmnotcovered{t}@*))};
                     return (*@\vdmnotcovered{maps}@*));
                     
(*@
\label{getTasksPatient:86}
@*)
 pure public getTasksPatient: Patient * Types`TaskType ==> map Hospital to set of(Task)
  getTasksPatient(p, t) == (*@\vdmnotcovered{(}@*)
                     dcl maps: map Hospital to set of(Task), med : set of (Task);
                     for all h in set hospitals do (*@\vdmnotcovered{(}@*)
                      for all m in set h.(*@\vdmnotcovered{getTasksByType}@*)((*@\vdmnotcovered{t}@*)) do
                       if(p = m.(*@\vdmnotcovered{getPatient}@*)())
                        then med := med union {(*@\vdmnotcovered{m}@*)};
                       
                      maps := maps munion {h |-> (*@\vdmnotcovered{med}@*)};
                      (*@\vdmnotcovered{med}@*) := (*@\vdmnotcovered{\{}@*)};);
                      return (*@\vdmnotcovered{maps}@*));
                     
  
end SafetyNetHospital
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[SafetyNetHospital:8]{SafetyNetHospital} & 8&100.0\% & 14 \\
\hline
\hyperref[addHospital:12]{addHospital} & 12&0.0\% & 0 \\
\hline
\hyperref[getHospitals:22]{getHospitals} & 22&0.0\% & 0 \\
\hline
\hyperref[getHospitalsMoreAppointments:26]{getHospitalsMoreAppointments} & 26&0.0\% & 0 \\
\hline
\hyperref[getMedAssociatedByPatient:53]{getMedAssociatedByPatient} & 53&0.0\% & 0 \\
\hline
\hyperref[getMedByHospital:65]{getMedByHospital} & 65&0.0\% & 0 \\
\hline
\hyperref[getMedMoreHospitals:35]{getMedMoreHospitals} & 35&0.0\% & 0 \\
\hline
\hyperref[getTasksByHospital:72]{getTasksByHospital} & 72&0.0\% & 0 \\
\hline
\hyperref[getTasksPatient:86]{getTasksPatient} & 86&0.0\% & 0 \\
\hline
\hyperref[getTrainingsByHospital:79]{getTrainingsByHospital} & 79&0.0\% & 0 \\
\hline
\hyperref[removeHospital:17]{removeHospital} & 17&0.0\% & 0 \\
\hline
\hline
SafetyNetHospital.vdmpp & & 6.1\% & 14 \\
\hline
\end{longtable}

