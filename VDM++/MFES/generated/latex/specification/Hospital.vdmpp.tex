\begin{vdmpp}[breaklines=true]
class Hospital
instance variables
  private medicalAssociated: set of (HealthProfessional);
  private agenda : set of (Agenda);
  private name: Types`String;
  private address: Types`String;
  private tasks: set of(Task);
  private trainings: set of(Training);
  private safetyNet: SafetyNetHospital;
 
 inv card medicalAssociated >= 0;
 inv card agenda <= card medicalAssociated;
 inv card tasks >= 0;
 inv card trainings >= 0;
operations
 -- Hospital constructor
(*@
\label{Hospital:17}
@*)
 public Hospital: Types`String * Types`String * SafetyNetHospital ==> Hospital
  Hospital(n, a, s) == (name := n; address := a; safetyNet := s; medicalAssociated := {}; tasks := {}; trainings := {}; agenda := {};
  safetyNet.addHospital(self); return self)
 post name = n and address = a and safetyNet = s and medicalAssociated = {} and tasks = {} and trainings = {} and agenda = {};
 
 -- Returns the hospital's name
(*@
\label{getName:23}
@*)
 pure public getName: () ==> Types`String
  getName() == (return name);
  
 -- Returns the hospital's address
(*@
\label{getAddress:27}
@*)
 pure public getAddress: () ==> Types`String
  getAddress() == (return address);
 
 -- Returns the tasks created on this hospital
(*@
\label{getTasks:31}
@*)
 pure public getTasks: () ==> set of (Task)
  getTasks() == (return tasks);
 
 -- Returns the trainings created on this hospital
(*@
\label{getTrainings:35}
@*)
 pure public getTrainings : () ==> set of (Training)
  getTrainings() == (return trainings);
 
 -- Returns all the agendas of the health professionals of this hospital
(*@
\label{getAgendas:39}
@*)
 pure public getAgendas : () ==> set of(Agenda)
  getAgendas() == (return agenda);
 
 -- Returns the schedules of a health professional's agenda
(*@
\label{getAgenda:43}
@*)
 pure public getAgenda : HealthProfessional ==> Agenda
  getAgenda(h) == (
   dcl a1 : Agenda;
   for all a2 in set agenda do
    if(a2.getHealthProfessional() = h)
     then a1 := a2;
   return a1);
 
 -- Removes an agenda
(*@
\label{removeAgenda:52}
@*)
 public removeAgenda : Agenda ==> ()
  removeAgenda(a) == (agenda := agenda \ {a})
 pre a in set agenda
 post a not in set agenda;
 
 -- Adds a health professional to the hospital's health professionals
(*@
\label{addMedAssociated:58}
@*)
 public addMedAssociated: HealthProfessional ==> ()
  addMedAssociated(d) == (
   dcl agendaNew : Agenda;
   agendaNew := new Agenda(d);
   medicalAssociated := {d} union medicalAssociated;
   agenda := agenda union {agendaNew})
 pre d not in set medicalAssociated
 post d in set medicalAssociated;
 
 -- Removes a health professional from the hospital's health professionals
(*@
\label{removeMedAssociated:68}
@*)
 public removeMedAssociated: HealthProfessional ==> ()
  removeMedAssociated(d) == (
   for all t in set tasks do
    if(d = t.getMedAssoc())
     then removeTask(t);
   for all t in set trainings do
    if(d = t.getMedAssoc())
     then removeTraining(t);
   for all a in set agenda do
    if(a.getHealthProfessional().getCC() = d.getCC())
     then removeAgenda(a);
   medicalAssociated := medicalAssociated \ {d})
 pre d in set medicalAssociated
 post d not in set medicalAssociated;
 
 -- Adds a task to the hospital
(*@
\label{addTask:84}
@*)
 public addTask: Task ==> ()
  addTask(d) == (
   if(d.getPatient() not in set d.getMedAssoc().getPatients())
    then d.getMedAssoc().addPatient(d.getPatient());
   tasks := {d} union tasks;
   for all a in set agenda do
    if(a.getHealthProfessional().getCC() = d.getMedAssoc().getCC())
      then a.removeSchedule(d.getSchedule());)
 pre d not in set tasks and d.getSchedule() in set getAgenda(d.getMedAssoc()).getAgenda()
 post d in set tasks and d.getPatient() in set d.getMedAssoc().getPatients() and d.getSchedule() not in set getAgenda(d.getMedAssoc()).getAgenda();
  
 -- Removes a task from the hospital
(*@
\label{removeTask:96}
@*)
 public removeTask: Task ==> ()
  removeTask(d) == (
   for all a in set agenda do
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.addSchedule(d.getSchedule());
   tasks := tasks \ {d})
 pre d in set tasks and d.getSchedule() not in set getAgenda(d.getMedAssoc()).getAgenda()
 post d not in set tasks and d.getSchedule() in set getAgenda(d.getMedAssoc()).getAgenda();
 
 -- Adds a training to the hospital
(*@
\label{addTraining:106}
@*)
 public addTraining: Training ==> ()
  addTraining(d) == (
   for all a in set agenda do
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.removeSchedule(d.getSchedule());
   trainings := {d} union trainings)
 pre d not in set trainings and d.getSchedule() in set getAgenda(d.getMedAssoc()).getAgenda()
 post d in set trainings and d.getSchedule() not in set getAgenda(d.getMedAssoc()).getAgenda();
 
 -- Removes a training from the hospital
(*@
\label{removeTraining:116}
@*)
 public removeTraining: Training ==> ()
  removeTraining(d) == (
   for all a in set agenda do
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.addSchedule(d.getSchedule());
   trainings := trainings \ {d})
 pre d in set trainings and d.getSchedule() not in set getAgenda(d.getMedAssoc()).getAgenda()
 post d not in set trainings and d.getSchedule() in set getAgenda(d.getMedAssoc()).getAgenda();
 
 -- Returns the tasks of a hospital by its type
(*@
\label{getTasksByType:126}
@*)
 pure public getTasksByType: Types`TaskType ==> set of (Task)
  getTasksByType(s) == (
   dcl tasksTotal: set of (Task);
   tasksTotal := {};
   for all t in set tasks do
    if(t.getType() = s)
     then tasksTotal := tasksTotal union {t};  
   return tasksTotal);
 
 -- Returns the trainings of a hospital by its type
(*@
\label{getTrainingsByType:136}
@*)
 pure public getTrainingsByType: Types`Purpose ==> set of (Training)
  getTrainingsByType(s) == (
   dcl train: set of (Training);
   train := {};
   for all t in set trainings do
    if(t.getPurpose() = s)
     then train := train union {t}; 
   return train);

 -- Returns the health professionals of a hospital
(*@
\label{getMedicalAssociated:146}
@*)
 pure public getMedicalAssociated: () ==> set of (HealthProfessional)
  getMedicalAssociated() == (
   return medicalAssociated);

 -- Returns the health professionals of a hospital by its type
(*@
\label{getMedicalAssociatedByType:151}
@*)
 pure public getMedicalAssociatedByType: Types`Type ==> set of (HealthProfessional)
  getMedicalAssociatedByType(type) == (
   dcl med: set of(HealthProfessional);
   med := {};
   for all d in set medicalAssociated do
    if(d.getType() = type)
     then med := med union {d};
   return med);
end Hospital
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[Hospital:17]{Hospital} & 17&100.0\% & 16 \\
\hline
\hyperref[addMedAssociated:58]{addMedAssociated} & 58&100.0\% & 29 \\
\hline
\hyperref[addTask:84]{addTask} & 84&100.0\% & 24 \\
\hline
\hyperref[addTraining:106]{addTraining} & 106&100.0\% & 2 \\
\hline
\hyperref[getAddress:27]{getAddress} & 27&100.0\% & 3 \\
\hline
\hyperref[getAgenda:43]{getAgenda} & 43&100.0\% & 92 \\
\hline
\hyperref[getAgendas:39]{getAgendas} & 39&100.0\% & 18 \\
\hline
\hyperref[getMedicalAssociated:146]{getMedicalAssociated} & 146&100.0\% & 1 \\
\hline
\hyperref[getMedicalAssociatedByType:151]{getMedicalAssociatedByType} & 151&100.0\% & 44 \\
\hline
\hyperref[getName:23]{getName} & 23&100.0\% & 13 \\
\hline
\hyperref[getTasks:31]{getTasks} & 31&100.0\% & 2 \\
\hline
\hyperref[getTasksByType:126]{getTasksByType} & 126&100.0\% & 24 \\
\hline
\hyperref[getTrainings:35]{getTrainings} & 35&100.0\% & 1 \\
\hline
\hyperref[getTrainingsByType:136]{getTrainingsByType} & 136&100.0\% & 12 \\
\hline
\hyperref[removeAgenda:52]{removeAgenda} & 52&100.0\% & 1 \\
\hline
\hyperref[removeMedAssociated:68]{removeMedAssociated} & 68&100.0\% & 1 \\
\hline
\hyperref[removeTask:96]{removeTask} & 96&100.0\% & 2 \\
\hline
\hyperref[removeTraining:116]{removeTraining} & 116&100.0\% & 2 \\
\hline
\hline
Hospital.vdmpp & & 100.0\% & 287 \\
\hline
\end{longtable}

