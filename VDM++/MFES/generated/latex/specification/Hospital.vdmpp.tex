\begin{vdmpp}[breaklines=true]
class Hospital
instance variables
  private medicalAssociated: set of (HealthProfessional);
  private agenda : set of (Agenda);
  private name: Types`String;
  private address: Types`String;
  private tasks: set of(Task);
  private trainings: set of(Training);
  private safetyNet: SafetyNetHospital;
 
 inv card medicalAssociated >= 0;
 inv card agenda <= card medicalAssociated;
 inv card tasks >= 0;
 inv card trainings >= 0;
operations

(*@
\label{Hospital:17}
@*)
 public Hospital: Types`String * Types`String * SafetyNetHospital ==> Hospital
  Hospital(n, a, s) == (name := n; address := a; safetyNet := s; medicalAssociated := {}; tasks := {}; trainings := {}; agenda := {};
  safetyNet.addHospital(self); return self)
 post name = n and address = a and safetyNet = s and medicalAssociated = {} and tasks = {} and trainings = {} and agenda = {};
 
(*@
\label{getName:22}
@*)
 pure public getName: () ==> Types`String
  getName() == (return name);
 
(*@
\label{getAddress:25}
@*)
 pure public getAddress: () ==> Types`String
  getAddress() == (return address);
  
(*@
\label{getAgendas:28}
@*)
(*@
\label{getTasks:28}
@*)
 pure public getTasks: () ==> set of (Task)
  getTasks() == (return tasks);
 
(*@
\label{getTrainings:31}
@*)
(*@
\label{getAgenda:31}
@*)
 pure public getTrainings : () ==> set of (Training)
  getTrainings() == (return trainings);
 
 pure public getAgendas : () ==> set of(Agenda)
  getAgendas() == (return agenda);
  
 pure public getAgenda : HealthProfessional ==> set of(Schedule)
  getAgenda(h) == (
   dcl agendaNew : set of(Schedule);
(*@
\label{removeAgenda:40}
@*)
   agendaNew := {};
   for all a in set agenda do
    if(a.getHealthProfessional() = h)
     then agendaNew := a.getAgenda();
   return agendaNew);
(*@
\label{addMedAssociated:45}
@*)
 
 public removeAgenda : Agenda ==> ()
  removeAgenda(a) == (agenda := agenda \ {a})
 pre a in set agenda
 post a not in set agenda;
 
 public addMedAssociated: HealthProfessional ==> ()
  addMedAssociated(d) == (
   dcl agendaNew : Agenda;
(*@
\label{removeMedAssociated:54}
@*)
   agendaNew := new Agenda(d);
   medicalAssociated := {d} union medicalAssociated;
   agenda := agenda union {agendaNew})
 pre d not in set medicalAssociated
 post d in set medicalAssociated;
  
 public removeMedAssociated: HealthProfessional ==> ()
  removeMedAssociated(d) == (
   for all t in set tasks do
    if(d = t.getMedAssoc())
     then removeTask(t);
   for all t in set trainings do
    if(d = t.getMedAssoc())
     then removeTraining(t);
   for all a in set agenda do
(*@
\label{addTask:69}
@*)
    if(a.getHealthProfessional().getCC() = d.getCC())
     then removeAgenda(a);
   medicalAssociated := medicalAssociated \ {d})
 pre d in set medicalAssociated
 post d not in set medicalAssociated;
 
 public addTask: Task ==> ()
  addTask(d) == (
   if(d.getPatient() not in set d.getMedAssoc().getPatients())
    then d.getMedAssoc().addPatient(d.getPatient());
   tasks := {d} union tasks;
(*@
\label{removeTask:80}
@*)
   for all a in set agenda do
    if(a.getHealthProfessional().getCC() = d.getMedAssoc().getCC())
      then a.removeSchedule(d.getSchedule());)
 pre d not in set tasks and d.getSchedule() in set getAgenda(d.getMedAssoc())
 post d in set tasks and d.getPatient() in set d.getMedAssoc().getPatients() and d.getSchedule() not in set getAgenda(d.getMedAssoc());
  
 public removeTask: Task ==> ()
  removeTask(d) == (
   for all a in set agenda do
(*@
\label{addTraining:89}
@*)
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.addSchedule(d.getSchedule());
   tasks := tasks \ {d})
 pre d in set tasks and d.getSchedule() not in set getAgenda(d.getMedAssoc())
 post d not in set tasks and d.getSchedule() in set getAgenda(d.getMedAssoc());
 
 public addTraining: Training ==> ()
  addTraining(d) == (
   for all a in set agenda do
(*@
\label{removeTraining:98}
@*)
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.removeSchedule(d.getSchedule());
   trainings := {d} union trainings)
 pre d not in set trainings and d.getSchedule() in set getAgenda(d.getMedAssoc())
 post d in set trainings and d.getSchedule() not in set getAgenda(d.getMedAssoc());
  
 public removeTraining: Training ==> ()
  removeTraining(d) == (
   for all a in set agenda do
(*@
\label{getTasksByType:107}
@*)
    if(a.getHealthProfessional() = d.getMedAssoc())
      then a.addSchedule(d.getSchedule());
   trainings := trainings \ {d})
 pre d in set trainings and d.getSchedule() not in set getAgenda(d.getMedAssoc())
 post d not in set trainings and d.getSchedule() in set getAgenda(d.getMedAssoc());
 
 pure public getTasksByType: Types`TaskType ==> set of (Task)
  getTasksByType(s) == (
   dcl tasksTotal: set of (Task);
   tasksTotal := {};
(*@
\label{getTrainingsByType:117}
@*)
   for all t in set tasks do
    if(t.getType() = s)
     then tasksTotal := tasksTotal union {t};
     
   return tasksTotal);
              
 pure public getTrainingsByType: Types`Purpose ==> set of (Training)
  getTrainingsByType(s) == (
   dcl train: set of (Training);
   train := {};
(*@
\label{getMedicalAssociatedByType:127}
@*)
   for all t in set trainings do
    if(t.getPurpose() = s)
     then train := train union {t};
     
   return train);

 pure public getMedicalAssociatedByType: Types`Type ==> set of (HealthProfessional)
  getMedicalAssociatedByType(type) == (
   dcl med: set of(HealthProfessional);
   med := {};
   for all d in set medicalAssociated do
    if(d.getType() = type)
     then med := med union {d};
    
   return med);
end Hospital
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[Hospital:17]{Hospital} & 17&100.0\% & 21 \\
\hline
\hyperref[addMedAssociated:45]{addMedAssociated} & 45&100.0\% & 11 \\
\hline
\hyperref[addTask:69]{addTask} & 69&100.0\% & 36 \\
\hline
\hyperref[addTraining:89]{addTraining} & 89&100.0\% & 10 \\
\hline
\hyperref[getAddress:25]{getAddress} & 25&100.0\% & 9 \\
\hline
\hyperref[getAgenda:31]{getAgenda} & 31&100.0\% & 114 \\
\hline
\hyperref[getAgendas:28]{getAgendas} & 28&100.0\% & 3 \\
\hline
\hyperref[getMedicalAssociatedByType:127]{getMedicalAssociatedByType} & 127&100.0\% & 115 \\
\hline
\hyperref[getName:22]{getName} & 22&100.0\% & 30 \\
\hline
\hyperref[getTasks:28]{getTasks} & 28&100.0\% & 2 \\
\hline
\hyperref[getTasksByType:107]{getTasksByType} & 107&100.0\% & 24 \\
\hline
\hyperref[getTrainings:31]{getTrainings} & 31&100.0\% & 1 \\
\hline
\hyperref[getTrainingsByType:117]{getTrainingsByType} & 117&100.0\% & 5 \\
\hline
\hyperref[removeAgenda:40]{removeAgenda} & 40&100.0\% & 1 \\
\hline
\hyperref[removeMedAssociated:54]{removeMedAssociated} & 54&100.0\% & 1 \\
\hline
\hyperref[removeTask:80]{removeTask} & 80&100.0\% & 2 \\
\hline
\hyperref[removeTraining:98]{removeTraining} & 98&100.0\% & 6 \\
\hline
\hline
Hospital.vdmpp & & 100.0\% & 391 \\
\hline
\end{longtable}

